name: Fly Production Deploy

on:
  push:
    branches:
      - main
env:
  FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
  MAILJET_API_KEY: ${{ secrets.MAILJET_API_KEY }}
  PRODUCTION_FLY_APP_NAME: ${{ secrets.PRODUCTION_FLY_APP_NAME }}
  NODE_ENV: production

jobs:
  deploy:
    name: Deploy app
    runs-on: ubuntu-latest

    steps:
      # check out repository and flyctl deploy
      - uses: actions/checkout@v2
      - uses: superfly/flyctl-actions/setup-flyctl@master
      - run: flyctl deploy --app ${PRODUCTION_FLY_APP_NAME} --build-target production
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
      - name: Check NODE_ENV
        run: echo "NODE_ENV value is $NODE_ENV"
